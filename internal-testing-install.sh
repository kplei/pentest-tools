#!/bin/bash

apt update -y
apt upgrade -y
mkdir ~/tools
cd ~/tools

## tilix
apt install -y tilix

## pyenv
apt install -y build-essential libssl-dev zlib1g-dev libbz2-dev libreadline-dev libsqlite3-dev wget curl llvm libncurses5-dev libncursesw5-dev xz-utils tk-dev libffi-dev liblzma-dev python3-openssl git
curl https://pyenv.run | bash
# for zsh
echo 'export PYENV_ROOT="$HOME/.pyenv"' >> ~/.zshrc
echo 'command -v pyenv >/dev/null || export PATH="$PYENV_ROOT/bin:$PATH"' >> ~/.zshrc
echo 'eval "$(pyenv init -)"' >> ~/.zshrc
# for bash
echo 'export PYENV_ROOT="$HOME/.pyenv"' >> ~/.bashrc
echo 'command -v pyenv >/dev/null || export PATH="$PYENV_ROOT/bin:$PATH"' >> ~/.bashrc
echo 'eval "$(pyenv init -)"' >> ~/.bashrc


## mitm6
git clone https://github.com/dirkjanm/mitm6.git
cd mitm6
python setup.py install
cd ..

## cmespray
#git clone https://github.com/XjnFc4kdAp/cmespray.git

## nxcspray
git clone https://github.com/kplei/nxcspray.git

## spraycharles
pip3 install pipx
pipx ensurepath
pipx install spraycharles

## PetitPotam
git clone https://github.com/topotam/PetitPotam.git

## DFSCoerce
git clone https://github.com/Wh04m1001/DFSCoerce.git

## ShadowCoerce
git clone https://github.com/ShutdownRepo/ShadowCoerce.git

## noPac
# don't run 'pip install -r requirements.txt' - it breaks impacket
git clone https://github.com/Ridter/noPac.git

## PKINITtools
git clone https://github.com/dirkjanm/PKINITtools.git
cd PKINITtools
pip install -r requirements.txt
cd ..

## certipy
pip3 install certipy-ad

## Krbrelayx
git clone https://github.com/dirkjanm/krbrelayx.git

## sd-util
git clone https://github.com/RackunSec/py-ad-tools.git

## eyewitness
git clone https://github.com/FortyNorthSecurity/EyeWitness.git
cd EyeWitness
./setup.sh 
cd ..

## WebClient Service Scanner
git clone https://github.com/Hackndo/WebclientServiceScanner.git
cd WebclientServiceScanner
python setup.py install
cd ..

## eaphammer
#git clone https://github.com/s0lst1c3/eaphammer
#cd eaphammer
#./kali-setup

## nessmerger
git clone https://github.com/Tw1sm/nessmerger.git
cd nessmerger
pip3 install -r requirements.txt
cd ..

## WebClient Service Scanner
git clone https://github.com/Hackndo/WebclientServiceScanner.git
cd WebclientServiceScanner
python ./setup.py install
cd ..

## PXETheif
git clone https://github.com/MWR-CyberSec/PXEThief.git
cd PXEThief
sed -i -e 's/pywin32>=303/#pywin32>=303/' ./requirements.txt
pip install -r requirements.txt
cd ..

## sccmhunter
git clone https://github.com/garrettfoster13/sccmhunter.git
cd sccmhunter
pip3 install -r requirements.txt
cd ..

## sccmwtf
git clone https://github.com/xpn/sccmwtf.git
cd sccmwtf
pip3 install -r requirements.txt
cd ..

## donpapi
pipx install donpapi
pipx ensurepath

##pywhisker
git clone https://github.com/ShutdownRepo/pywhisker.git
cd pywhisker
pip3 install -r requirements.txt
cd ..

## latest cme version
#apt-get install -y libssl-dev libffi-dev python-dev-is-python3 build-essential
#git clone --recursive https://github.com/byt3bl33d3r/CrackMapExec
#cd CrackMapExec
#pip3 install poetry
#poetry install
#cd ..

## install NetExec - replacing CME
pipx ensurepath
pipx install git+https://github.com/Pennyw0rth/NetExec

## bloodhound collector
pip install bloodhound

## bloodhound/neo4j fix 
REPO=/etc/apt/sources.list.d/neo4j.list
if test -f "$REPO"; then
    apt remove neo4j
    mv /etc/apt/sources.list.d/neo4j.list /etc/apt/sources.list.d/neo4j.list.bak
    apt update -y
    apt install -y neo4j bloodhound
fi

exec "$SHELL"

